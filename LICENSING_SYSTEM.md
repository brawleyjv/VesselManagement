# Vessel Data Logger - Licensing System

## Overview
This document explains the complete licensing system for the Vessel Data Logger application, including online and offline license generation, validation, and customer sales flow.

## File Structure

### Core Application Files
- `main.js` - Electron application entry point
- `package.json` - Application configuration and build settings
- `install.php` - 5-step installation wizard with license validation
- `config_sqlite.php` - SQLite database configuration
- `company_config.php` - Generated during installation with company/license info

### Sales & Marketing
- `landing.html` - Main sales/marketing page with PayPal integration
- `landing-style.css` - Styling for landing page
- `landing-script.js` - PayPal button and purchase flow
- `download.html` - Download page with installer and instructions

### License Management
- `api/generate-license.php` - Online license generation API (for PayPal purchases)
- `api/validate-license.php` - Online license validation API
- `generate_offline_license.php` - CLI script for generating offline licenses

### Setup & Distribution
- `setup-php.ps1` - Automated PHP runtime setup
- `setup-php-manual.ps1` - Manual PHP setup fallback
- `dist/` - Built application installer (generated by `npm run dist`)

## License System Features

### 1. Dual Validation System
The application supports both online and offline license validation:

**Online Validation:**
- Connects to your server's validation API
- Real-time license verification
- Prevents license sharing/piracy
- Tracks license usage

**Offline Validation:**
- Works without internet connection
- Uses algorithmic validation based on customer email
- Fallback when online validation fails
- Perfect for vessels at sea

### 2. License Key Format
All license keys follow the format: `VDL-XXXX-XXXX-XXXX`
- VDL = Vessel Data Logger prefix
- Each XXXX segment contains 4 alphanumeric characters
- Example: `VDL-AB12-CD34-EF56`

### 3. Test/Demo Licenses
Built-in test licenses for demonstrations:
- `VDL-DEMO-TEST-2025`
- `VDL-EVAL-TRIAL-001`
- `VDL-TEST-OFFLINE-123`

## Setup Instructions

### 1. Online License System Setup

1. **Upload API files to your web server:**
   ```
   logicdock.org/api/generate-license.php
   logicdock.org/api/validate-license.php
   ```

2. **Update domain in install.php:**
   ```php
   // Already configured with logicdock.org
   // Uses config_paypal.php for centralized settings
   ```

3. **Configure PayPal in landing-script.js:**
   ```javascript
   // Update with your PayPal client ID
   'client-id': 'YOUR_PAYPAL_CLIENT_ID'
   ```

4. **Update email settings in generate-license.php:**
   ```php
   // Configure your SMTP settings or email service
   mail($customer_email, $subject, $message, $headers);
   ```

### 2. Offline License Generation

Use the CLI script to generate licenses manually:

```bash
# Generate license for a customer
php generate_offline_license.php customer@email.com "Customer Name"

# Example output:
# License Key: VDL-A1B2-C3D4-E5F6
```

The script will:
- Generate a unique license key based on the customer's email
- Create a license file with customer details
- Log the generation for your records

### 3. PayPal Integration Setup

1. **Create PayPal Developer Account:**
   - Go to https://developer.paypal.com/
   - Create a new app for your business
   - Get your Client ID and Client Secret

2. **Update PayPal Configuration:**
   ```javascript
   // In landing-script.js
   paypal.Buttons({
       createOrder: function(data, actions) {
           return actions.order.create({
               purchase_units: [{
                   amount: {
                       value: '299.00' // Your license price
                   }
               }]
           });
       }
   })
   ```

3. **Test the Flow:**
   - Use PayPal sandbox for testing
   - Test license generation and email delivery
   - Verify license validation in the installer

## Installation Wizard Flow

### Step 1: License Verification
- Customer enters license key, name, and email
- System validates license (online first, offline fallback)
- Prevents installation without valid license

### Step 2: Company Information
- Company name, address, vessel type
- Timezone selection (critical for logging accuracy)

### Step 3: Administrator Setup
- Main admin account creation
- Secure password requirements
- Email verification

### Step 4: Initial Vessel Setup
- First vessel configuration
- Operating parameters (RPM, temperature ranges)
- Equipment specifications

### Step 5: Installation Complete
- Database initialization
- Configuration file generation
- Test admin account creation (username: admin, password: admin123)

## Test Admin Account

The system automatically creates a test admin account:
- **Username:** admin
- **Password:** admin123
- **Restrictions:** Can only access "Test Vessel"
- **Purpose:** Demo and training

This account is perfect for:
- Customer demonstrations
- Training new users
- Testing without affecting real data

## Customer Sales Flow

1. **Customer visits landing page** (`landing.html`)
2. **Downloads free trial** (`download.html`)
3. **Installs application** (requires demo license)
4. **Tests with admin/admin123** (restricted to Test Vessel)
5. **Purchases full license** (PayPal integration)
6. **Receives license via email** (automatic)
7. **Reinstalls with full license** (access to all features)

## Building and Distribution

### Development Build
```bash
npm run electron:dev
```

### Production Build
```bash
npm run dist
```

This creates:
- `dist/Vessel Data Logger-Setup.exe` - Windows installer
- Includes all dependencies (Electron, PHP runtime, application files)
- NSIS installer with professional appearance

### Installer Features
- Professional installer UI
- Start menu shortcuts
- Desktop shortcut option
- Uninstaller registration
- File associations
- Auto-updater support (future)

## Security Considerations

### License Protection
- Online validation prevents sharing
- Email-based offline validation
- Algorithmic key generation prevents guessing
- Server-side validation logs

### Data Security
- SQLite database with local storage
- No sensitive data transmitted
- Company data stays on vessel
- Backup and export capabilities

### Access Control
- Role-based permissions
- Test admin restrictions
- Secure password requirements
- Session management

## Troubleshooting

### Common Issues

**License Validation Fails:**
- Check internet connection
- Verify email matches license
- Try offline validation
- Contact support with license key

**Installation Problems:**
- Run installer as administrator
- Check Windows Defender/antivirus
- Verify system requirements
- Use manual PHP setup if needed

**PHP Runtime Issues:**
- Check PowerShell execution policy
- Manual PHP extraction
- Port conflicts (8080 in use)
- Firewall blocking local server

### Support Information
- Email: support@vesseldatalogger.com
- Include license key in support requests
- Attach error messages/screenshots
- Response time: 24 hours

## Future Enhancements

### Planned Features
- Galley operations module
- Deck management system
- Navigation logging
- Advanced reporting
- Multi-vessel management
- Cloud synchronization (optional)

### License Upgrades
- Module-based licensing
- Feature unlocks
- Multi-vessel licenses
- Enterprise editions
- Training/educational licenses

## License Revenue Tracking

The system logs all license generations:
- `license_generation.log` - Offline license log
- API logs - Online license tracking
- PayPal transaction records
- Customer database integration

This provides complete visibility into:
- Sales volume
- Customer demographics
- License usage patterns
- Support requirements

---

**Note:** Remember to replace placeholder values (your-domain.com, PayPal credentials, email settings) with your actual production values before deployment.
